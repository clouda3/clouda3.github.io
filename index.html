<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=generator content="Hugo 0.59.1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>云端的blog |</title><meta property="og:title" content="云端的blog |"><meta property="og:type" content="website"><meta name=Keywords content><meta name=description content><meta property="og:url" content="https://clouda3.github.io/"><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/css/normalize.css><link rel=stylesheet href=/css/style.css><link rel=alternate type=application/rss+xml+xml href=https://clouda3.github.io/index.xml title=云端的blog><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href=https://clouda3.github.io/>云端的blog</a></h1></div><div><nav id=nav-menu class=clearfix><a class=current href=https://clouda3.github.io/>首页</a>
<a href=https://clouda3.github.io/posts/ title=Blog>Blog</a>
<a href=https://clouda3.github.io/tags/ title=Tags>Tags</a>
<a href=https://clouda3.github.io/about title=About>About</a>
<a href=https://clouda3.github.io/index.xml title=RSS>RSS</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title><a href=https://clouda3.github.io/posts/application-network-issue-caused-thread-block/ title=交换机故障导致线程阻塞>交换机故障导致线程阻塞</a></h1></header><date class="post-meta meta-date">2021年8月21日</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=https://clouda3.github.io/categories/architect>architect</a></span></div><div class=post-content>本来使用工具或者服务 Jconsole Jstack prometheus 架构图 架构说明 This is an internal application (Not cloud) architect,we have big network traffic and lots of application ,we deploy in our own server
we have a RabbitMQ server (which our data provider will send HKEX data to this server)
we have an Application will consume the messages from MQ
Our application will process the data and sending to Kafka and Elastic search……</div><p class=readmore><a href=https://clouda3.github.io/posts/application-network-issue-caused-thread-block/>阅读全文</a></p></article><article class=post><header><h1 class=post-title><a href=https://clouda3.github.io/posts/kafka-cluster-setup/ title="kafka cluster的搭建">kafka cluster的搭建</a></h1></header><date class="post-meta meta-date">2021年7月30日</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=https://clouda3.github.io/categories/kafka>kafka</a></span></div><div class=post-content>本文使用工具或者服务 Java 8 https://archive.apache.org/dist/kafka/3.0.0/kafka_2.13-3.0.0.tgz https://www.apache.org/dyn/closer.lua/zookeeper/zookeeper-3.7.0/apache-zookeeper-3.7.0-bin.tar.gz Centos8.2 Zookeeper 簡介 ZooKeeper是一个分布式协调服务，它的主要作用是为分布式系统提供一致性服务，提供的功能包括：配置维护、命名服务、分布式同步、组服务等。Kafka的运行依赖ZooKeeper。
Broker注册 Topic注册 生产者负载均衡 消费者负载均衡 消费者注册
Kafka 簡介 Kafka是由Apache软件基金会开发的一个开源流处理平台，由Scala和Java编写。Kafka是一种高吞吐量的分布式发布订阅消息系统，它可以处理消费者在网站中的所有动作流数据。
Kafka 是一种高吞吐量的分布式发布订阅消息系统，有如下特性： 通过O(1)的磁盘数据结构提供消息的持久化，这种结构对于即使数以TB的消息存储也能够保持长时间的稳定性能。 高吞吐量 即使是非常普通的硬件Kafka也可以支持每秒数百万的消息。 支持通过Kafka服务器和消费机集群来分区消息。 zookeeper 與kafka之間的關係 ZooKeeper用于分布式系统的协调，Kafka使用ZooKeeper也是基于相同的原因。ZooKeeper主要用来协调Kafka的各个broker，不仅可以实现broker的负载均衡，而且当增加了broker或者某个broker故障了，ZooKeeper将会通知生产者和消费者，这样可以保证整个系统正常运转。 安裝zooker和kafka 之前首先要做系統的優化和配置 文件句柄數的調整 oracle Jre8 安裝 磁盤的分區和挂載點必須滿足kafka大數量的存儲xfs分區 關閉selinux 防火墻暫時關閉(後面看可以統一規劃端口) 創建非root的kafka管理用戶並添加sudoer權限 注意事項 kafka是一個分佈式的消息系統，我們會臨時存儲消息，如果存儲消息的時間長，那麽需要大空間，所以分區的時候已經要注意，就是安裝kafka的時候存儲一定要挂載到大的硬盤空間上 Zookeeper 配置 # The number of milliseconds of each tick tickTime=2000 # The number of ticks that the initial # synchronization phase can take initLimit=10 # The number of ticks that can pass between # sending a request and getting an acknowledgement syncLimit=5 # the directory where the snapshot is stored.……</div><p class=readmore><a href=https://clouda3.github.io/posts/kafka-cluster-setup/>阅读全文</a></p></article><article class=post><header><h1 class=post-title><a href=https://clouda3.github.io/posts/alicloud_privatelink/ title=阿里云架构-使用privatelink让不同的vpc的服务可以访问>阿里云架构-使用privatelink让不同的vpc的服务可以访问</a></h1></header><date class="post-meta meta-date">2021年7月28日</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=https://clouda3.github.io/categories/alicloud>Alicloud</a></span></div><div class=post-content>本来使用工具或者服务 Alicloud vpc SLB PrivateLink endpoit zone and service ECS 架构图 架构说明 对于两个网络（VPC-A，VPC-B）的ECS提供的服务，要是A访问B，可以提供以下方案
B通过EIP或者IP或者绑定SLB，通过SLB的IP把B的服务暴露在公网上 A网络和B网络互联 通过privatelink来单向向让A网络的访问B网络的服务 分析上面优缺点
安全性不好，把服务暴露在公网 A和B网络直接互联创建路由成本太高，第二就是可能会造成网络冲突 通过privatelink私有网络连接成本低廉，单向的内网服务，不改变各自的网络配置 Privatelink 如何创建privatelink服务
privatelind endpoint service：需要关联一个SLB，此slb必须支持privatelink的SLB，slb后面就是ECS或者其他的rds等都可以
privatelink endpoint 创建的是时候需要跟endpoint service 连接 一旦创建并且链接成功，那么privatelink就可以生效了
privatelink endpoint 有一个DNS地址，我们可以通过地址直接访问，此地址是aliyun内网地址
……</div><p class=readmore><a href=https://clouda3.github.io/posts/alicloud_privatelink/>阅读全文</a></p></article><article class=post><header><h1 class=post-title><a href=https://clouda3.github.io/posts/jenkins_create_new_node/ title=如何配置jenkins新节点>如何配置jenkins新节点</a></h1></header><date class="post-meta meta-date">2020年10月13日</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=https://clouda3.github.io/categories/jenkins>jenkins</a></span></div><div class=post-content>jenkins 节点 简介 在企业里面使用Jenkins自动部署时，大部分企业更新发布几个软件版本,但是对于一些公司有非常多的业务线或者产品来说，Jenkins就需要同时处理很多的任务，这时候就需要借助Jenkins多个node或者我们所说的Jenkins分布式SLAVE节点，来分开处理多个产品或者业务线的部署，目的就是master节点用来分配任务，slave节点来具体执行部署任务 配置 slave节点 jenkins -&gt;manage jenins -&gt; manage node and cloud -&gt;new node node name:test ,选择permanent node 填好number of executors:1 ,remote root,launch method:launch agent via ssh,Host,Credentials, Host Key Verification Strategy,known hosts file verification strategy ,availability:keep agent online as much as possible 在slave上安装各种需要软件 一定要安装相关的plugin和global tool configuration里面配置相关的工具软件 e 创建一个pipeline测试一下
pipeline { agent any stages { stage('Example') { steps { echo 'Hello World' } } } post { always { echo 'I will .……</div><p class=readmore><a href=https://clouda3.github.io/posts/jenkins_create_new_node/>阅读全文</a></p></article><article class=post><header><h1 class=post-title><a href=https://clouda3.github.io/posts/linux-tcp-udp-port-test/ title=如何测试linux的tcp和udp端口>如何测试linux的tcp和udp端口</a></h1></header><date class="post-meta meta-date">2020年6月2日</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=https://clouda3.github.io/categories/linux>linux</a></span></div><div class=post-content>如何测试linux的tcp和udp端口 测试tcp 一般用使用 telnet
telnet 192.168.12.10 22 telnet 不支持udp协议，所以我们可以使用nc,nc可以支持tcp也可以支持udp
yum install -y nc nc -z -v 192.168.10.12 22 #tcp nc -z -v -u 192.168.10.12 123 # udp ……</div><p class=readmore><a href=https://clouda3.github.io/posts/linux-tcp-udp-port-test/>阅读全文</a></p></article><article class=post><header><h1 class=post-title><a href=https://clouda3.github.io/posts/alicloud-terraform-create-ecs-ansible-provision/ title=使用terraform创建阿里ecs用ansible完成主机配置>使用terraform创建阿里ecs用ansible完成主机配置</a></h1></header><date class="post-meta meta-date">2020年5月29日</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=https://clouda3.github.io/categories/ansible>ansible</a></span>
<span class=meta-category><a href=https://clouda3.github.io/categories/terraform>terraform</a></span></div><div class=post-content>使用terraform创建ecs用ansible完成ecs的provision 本文目标就是是用terraform创建ecs包括security group,disk,vpc,vswtich,然后用ansible来初始化和配置创建好的ecs 本文只是创建了一个单机ecs，后续的文章会有load balance出现 terrorm 创建ecs 什么是terraform terraform是云工具，也就是针对云平台的 terraform是在云平台上管理资源的，就是一个云资源编排工具 terraform目标是&rdquo;Write, Plan, and create Infrastructure as Code&rdquo;, 基础架构即代码。具体的说就是可以用代码来管理维护 IT 资源，把之前需要手动操作的一部分任务通过程序来自动化的完成，这样的做的结果非常明显：高效、不易出错。 Terraform 核心功能
基础架构即代码(Infrastructure as Code) 执行计划(Execution Plans) 资源图(Resource Graph) 自动化变更(Change Automation) terraform安装
下载https://www.terraform.io/downloads.html 设置环境变量（省略） 创建terraform 配置文件
main.tf
provider &quot;alicloud&quot; { access_key = &quot;xxx&quot; secret_key = &quot;xxx&quot; region = &quot;ap-southeast-1&quot; #version = &quot;~&gt; 1.5.0&quot; } data &quot;alicloud_instance_types&quot; &quot;instance_type&quot; { instance_type_family = &quot;ecs.……</div><p class=readmore><a href=https://clouda3.github.io/posts/alicloud-terraform-create-ecs-ansible-provision/>阅读全文</a></p></article><article class=post><header><h1 class=post-title><a href=https://clouda3.github.io/posts/ansible-deploy-docker-container/ title=使用ansible在多台客户机安装docker>使用ansible在多台客户机安装docker</a></h1></header><date class="post-meta meta-date">2020年5月22日</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=https://clouda3.github.io/categories/ansible>ansible</a></span>
<span class=meta-category><a href=https://clouda3.github.io/categories/docker>docker</a></span></div><div class=post-content>Install ansible on server Ansible是一个开源配置管理工具，可以使用它来自动化任务，部署应用程序实现IT基础架构。Ansible可以用来自动化日常任务，比如，服务器的初始化配置、安全基线配置、更新和打补丁系统，安装软件包等 Ansible包括控制节点（Control node）也叫主机，受控节点（Managed nodes）也叫客户机,只在控制节点安装就好了 ansible 优点 只需要在主机上安装ansible软件，客户机不需要安装 通讯协议SSH协议和SFTP 可并行执行程序，默认情况下，forks值为5，可以按需，在配置文件中增大该值 ansible(centos)安装和配置 yum install ansible
为了使Ansible与客户端通信，需要使用用户帐户配置管理机和客户机。为了方便快捷安全，一般会配置证书方式连接客户机
ssh-keygen ssh-copy-id ansible@node ip 使用ad-hoc 在客户执行命令，相当于命令行 /etc/ansible/hosts,最好谨慎使用hosts配置，安全问题需要解决
[docker] 192.168.25.173 ansible_ssh_port=22 ansible_ssh_user=root ansible_ssh_pass=&quot;xxx&quot; 执行以下ping,命令里面的docker对应的上面文件的docker
ansible docker -m ping 使用ad-hoc命令管理软件包,安装
ansible docker -m yum -a &quot;name=docker state=present&quot; -b 使用ad-hoc命令管理软件包,设置默认启动
ansible docker -b -m service -a &quot;name=docker enabled=yes&quot; 使用ad-hoc命令管理软件包,启动
ansible docker -b -m service -a &quot;name=httpd state=started&quot; 使用ansible-playbook 部署docker test-ansile.……</div><p class=readmore><a href=https://clouda3.github.io/posts/ansible-deploy-docker-container/>阅读全文</a></p></article><article class=post><header><h1 class=post-title><a href=https://clouda3.github.io/posts/linux-cerbot/ title=给nginx安装免费的证书>给nginx安装免费的证书</a></h1></header><date class="post-meta meta-date">2020年5月8日</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=https://clouda3.github.io/categories/linux>linux</a></span></div><div class=post-content>https vs http https比http安全原因是传输的过程中使用了加密，因为https在服务器端使用证书 证书的认证需要认证机构，随便一个https的证书阿里巴巴云最便宜的一年要2000多，aws更是贵到天上，所以对于个人程序员来来说最好有免费的证书 cerbot就是你的选择 cerbot简介 cerbot就是Electronic Frontier Foundation (EFF)这个机构给大家发的福利，简单的一句话来说就是给你提供3个月的免费证书，证书到期后继续免费续约，个人网站是用最方便，每三个月更新一次就可以了 cerbot 使用 cerbot 安装脚本
yum -y install yum-utils yum-config-manager --enable rhui-REGION-rhel-server-extras rhui-REGION-rhel-server-optional sudo yum install certbot python2-certbot-nginx sudo certbot --nginx(sudo certbot certonly --nginx) echo &quot;0 0,12 * * * root python -c 'import random; import time; time.sleep(random.random() * 3600)' &amp;&amp; certbot renew -q&quot; | sudo tee -a /etc/crontab &gt; /dev/null (auto renewal) cerbot 证书验证 To confirm that your site is set up properly, visit https://yourwebsite.……</div><p class=readmore><a href=https://clouda3.github.io/posts/linux-cerbot/>阅读全文</a></p></article><article class=post><header><h1 class=post-title><a href=https://clouda3.github.io/posts/linux-openvpn-install/ title=Openvpn最简单的安装方式>Openvpn最简单的安装方式</a></h1></header><date class="post-meta meta-date">2020年5月8日</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=https://clouda3.github.io/categories/linux>linux</a></span></div><div class=post-content>为什么会用到vpn vpn是我们经常会用到的工具，比如有些程序不允许我们在某些地区下载，有些网站我们没有办法看之类的，我们就vpn不管是pptp还是vpn无非改变都是路由问题，也就是你上网的出口的问题 openvpn openvpn是一款开源vpn软件，功能非常强大，用户非常多，遵循的是openvpn协议 缺点搭建有些复杂，但是有第三方的脚本协助搭建会非常简单
openvpn搭建借助于第三方脚本 作者git：https://github.com/Nyr/openvpn-install
wget https://git.io/vpn -O openvpn-install.sh &amp;&amp; bash openvpn-install.sh 最后生成一个*.ovpn文件
下载并安装openvpn gui：https://openvpn.net/community-downloads/
用安装好的客户端打开*.ovpn就可以登录远程的vpn服务器了
……</div><p class=readmore><a href=https://clouda3.github.io/posts/linux-openvpn-install/>阅读全文</a></p></article><article class=post><header><h1 class=post-title><a href=https://clouda3.github.io/posts/linux-file-max-open/ title=linux最大文件打开数>linux最大文件打开数</a></h1></header><date class="post-meta meta-date">2020年5月7日</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=https://clouda3.github.io/categories/linux>linux</a></span></div><div class=post-content>文件最大打开数 如果服务器提供TCP服务（TCP层或者HTTP层），在并发访问量持续很高时，容易产生too many open files错误。这时查看netstat可以发现很多TIME_WAIT状态的链接，这说明大量链接处于半开状态，已经完成了请求响应，然后进行下一步操作，如果句柄数(文件打开数)超过了阈值，那就只能等待或者出错 解决方案 系统内核的修改
cat /proc/sys/fs/file-max sysctl -a sysctl -p 每个用户级别的修改
ulimit -n 1024000 (临时修改) vim /etc/security/limits.conf * soft nofile 2048 * hard nofile 2048 如果阿里云或者aws云里面的centos都是被优化过的，默认的1024都被修改成了65536了，所以对于大部分人来说足够用了
……</div><p class=readmore><a href=https://clouda3.github.io/posts/linux-file-max-open/>阅读全文</a></p></article><ol class=page-navigator><li class=current><a href=https://clouda3.github.io/>1</a></li><li><a href=https://clouda3.github.io/page/2/>2</a></li><li><a href=https://clouda3.github.io/page/3/>3</a></li><li><a href=https://clouda3.github.io/page/4/>4</a></li><li class=next><a href=https://clouda3.github.io/page/2/>下一页</a></li></ol></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch value=https://clouda3.github.io/>
<button type=submit class="submit icon-search"></button></form></section><section class=widget><div class=addthis_inline_follow_toolbox></div><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5ddc902b7d401ce9"></script></section><section class=widget><h3 class=widget-title>最近文章</h3><ul class=widget-list><li><a href=https://clouda3.github.io/posts/application-network-issue-caused-thread-block/ title=交换机故障导致线程阻塞>交换机故障导致线程阻塞</a></li><li><a href=https://clouda3.github.io/posts/kafka-cluster-setup/ title="kafka cluster的搭建">kafka cluster的搭建</a></li><li><a href=https://clouda3.github.io/posts/alicloud_privatelink/ title=阿里云架构-使用privatelink让不同的vpc的服务可以访问>阿里云架构-使用privatelink让不同的vpc的服务可以访问</a></li><li><a href=https://clouda3.github.io/posts/jenkins_create_new_node/ title=如何配置jenkins新节点>如何配置jenkins新节点</a></li><li><a href=https://clouda3.github.io/posts/linux-tcp-udp-port-test/ title=如何测试linux的tcp和udp端口>如何测试linux的tcp和udp端口</a></li><li><a href=https://clouda3.github.io/posts/alicloud-terraform-create-ecs-ansible-provision/ title=使用terraform创建阿里ecs用ansible完成主机配置>使用terraform创建阿里ecs用ansible完成主机配置</a></li><li><a href=https://clouda3.github.io/posts/ansible-deploy-docker-container/ title=使用ansible在多台客户机安装docker>使用ansible在多台客户机安装docker</a></li><li><a href=https://clouda3.github.io/posts/linux-cerbot/ title=给nginx安装免费的证书>给nginx安装免费的证书</a></li><li><a href=https://clouda3.github.io/posts/linux-openvpn-install/ title=Openvpn最简单的安装方式>Openvpn最简单的安装方式</a></li><li><a href=https://clouda3.github.io/posts/linux-file-max-open/ title=linux最大文件打开数>linux最大文件打开数</a></li></ul></section><section class=widget><h3 class=widget-title>分类</h3><ul class=widget-list><li><a href=https://clouda3.github.io/categories/alicloud/>Alicloud (1)</a></li><li><a href=https://clouda3.github.io/categories/ansible/>ansible (2)</a></li><li><a href=https://clouda3.github.io/categories/architect/>architect (1)</a></li><li><a href=https://clouda3.github.io/categories/aws/>aws (17)</a></li><li><a href=https://clouda3.github.io/categories/cloud/>cloud (17)</a></li><li><a href=https://clouda3.github.io/categories/docker/>docker (2)</a></li><li><a href=https://clouda3.github.io/categories/gohugo/>gohugo (3)</a></li><li><a href=https://clouda3.github.io/categories/jenkins/>jenkins (1)</a></li><li><a href=https://clouda3.github.io/categories/kafka/>kafka (1)</a></li><li><a href=https://clouda3.github.io/categories/kubernets/>kubernets (1)</a></li><li><a href=https://clouda3.github.io/categories/linux/>linux (8)</a></li><li><a href=https://clouda3.github.io/categories/terraform/>terraform (1)</a></li><li><a href=https://clouda3.github.io/categories/vagrant/>vagrant (1)</a></li><li><a href=https://clouda3.github.io/categories/vm/>vm (1)</a></li></ul></section><section class=widget><h3 class=widget-title>标签</h3><div class=tagcloud><a href=https://clouda3.github.io/tags/ansible/>ansible</a>
<a href=https://clouda3.github.io/tags/aws/>aws</a>
<a href=https://clouda3.github.io/tags/block/>block</a>
<a href=https://clouda3.github.io/tags/cert/>cert</a>
<a href=https://clouda3.github.io/tags/docker/>docker</a>
<a href=https://clouda3.github.io/tags/hugo/>hugo</a>
<a href=https://clouda3.github.io/tags/ingress/>ingress</a>
<a href=https://clouda3.github.io/tags/jenkins/>jenkins</a>
<a href=https://clouda3.github.io/tags/jvm/>JVM</a>
<a href=https://clouda3.github.io/tags/k8s/>k8s</a>
<a href=https://clouda3.github.io/tags/kafka/>kafka</a>
<a href=https://clouda3.github.io/tags/linux/>linux</a>
<a href=https://clouda3.github.io/tags/lvm/>lvm</a>
<a href=https://clouda3.github.io/tags/maxfileopen/>maxfileopen</a>
<a href=https://clouda3.github.io/tags/openvpn/>openvpn</a>
<a href=https://clouda3.github.io/tags/pipeline/>pipeline</a>
<a href=https://clouda3.github.io/tags/privatelink/>privatelink</a>
<a href=https://clouda3.github.io/tags/saa/>saa</a>
<a href=https://clouda3.github.io/tags/sap/>sap</a>
<a href=https://clouda3.github.io/tags/sshkey/>sshkey</a>
<a href=https://clouda3.github.io/tags/terraform/>terraform</a>
<a href=https://clouda3.github.io/tags/themes/>themes</a>
<a href=https://clouda3.github.io/tags/vagrant/>vagrant</a>
<a href=https://clouda3.github.io/tags/vm/>vm</a>
<a href=https://clouda3.github.io/tags/vpc/>vpc</a>
<a href=https://clouda3.github.io/tags/vpn/>vpn</a>
<a href=https://clouda3.github.io/tags/zookeeper/>zookeeper</a></div></section><section class=widget><h3 class=widget-title>其它</h3><ul class=widget-list><li><a href=https://clouda3.github.io/index.xml>文章 RSS</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2022 <a href=https://clouda3.github.io/>云端的blog By </a>.
Powered by <a rel="nofollow noreferer noopener" href=https://gohugo.io target=_blank>Hugo</a>.</div></footer><a id=rocket href=#top></a><script type=text/javascript src="/js/totop.js?v=0.0.0" async></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-153597822-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-153597822-1');</script></body></html>